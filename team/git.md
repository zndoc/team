Правила GIT
===

## Основное правило

Ветку __master__ всегда можно развернуть. Всегда.

Развёртываемая (стабильная) ветка __master__ важна по нескольким причинам. 
Первым делом, это позволяет любому новичку на проекте выкачать и собрать проект без ошибок. 
Ничто так не разочаровывает, как невозможность собрать проект, с которым не знаком.

Во-вторых, __master__ показывает текущее состояние проекта в производстве. 
Если нужно сделать правки - всегда ясно, от чего надо ответвляться.

И, наконец, разворачиваемый __master__ - это страховочная сеть. 
Если __master__ корректный - то мы в любой момент можем развернуть проект 
из ветки без опасений, что что-то отвалится.

## Стратегии ветвления

Ветка __develop__ должна быть основной веткой, в которой ведётся разработка. 
Ветки для внедрения новых возможностей должны ответвляться от этой ветки, 
и вливаться обратно в ветку __develop__, 
а ветка __develop__ представляет состояние кодовой базы проекта на текущий момент.

Так как обе ветки - __master__ и __develop__ - являются постоянными, 
и постоянно затрагиваемыми, то работа с ними никогда не должна вестись напрямую. 
Вместо этого, вся работа должна вестись в отдельных ветках.

Ветки __master__ и __develop__ желательно заблокировать от записи.

Для начала работы, клонируем ветку __develop__.

При старте выполнения задачи ответвиться от ветки __develop__, 
и разработку вести во вновь созданной ветке.

Другими словами, разделяйте реализацию задач так, 
чтобы непересекающийся функционал был в разных ветках.

## Как именовать ветки

Давайте веткам понятные имена, чтобы прочитав имя, 
было понятно, с какой задачей она связана.

Обычно ветку называют так: 

```
task-1234
```

В конце имени ветки необходимо добавлять **ID** выполняемой задачи.
Так будет легче соотносить ветки с задачами.

### Trello

В **Trello** ID можно найти в адресной строке:

https://trello.com/c/hS27i4mg/907-блоки-с-акциями

Тут **ID** будет равно - **907**.

Открыть задачу для ветки можно так:

* зная проект, мы знаем бызовый URL в трелло - `https://trello.com/c/hS27i4mg/`
* далее подставляем ID задачи - `907`

в результате получаем - `https://trello.com/c/hS27i4mg/907`.

### Jira

Если работаем в **Jira**, то называем ветки так:

```
BG-166
RH-123
WS-432
```

`BG`, `RH`, `WS` - это префиксы проектов в **Jira**.
За префиксом идет **ID** задачи.

## Код-ревью и автотесты

Скажем, мы сделали ветку, понаписали кода, обновили изменения из __develop__, 
и вот мы готовы к заливке кода обратно в __develop__.

Создаем __pull-request__ на слияние своей ветки с __develop__ и приступаем к следующей задаче.

## Поправь, пока не остыло

Мы не должны выпускать ошибки.

…но уж если это произошло, то лучше их поправить как можно быстрее. 
Так как ветка __develop__ может содержать незаконченные изменения, 
ветки критических правок надо создавать от текущего релиза, 
который находится в master (так как __master__ всегда служит 
для разворачивания для конечных пользователей).

Чтобы сделать правку, создайте ветку от __master__, сделайте правку, 
потом сделайте неперематываемое слияние (__non-fast-forward merge__) в __master__. 
Создайте тег, слейте __master__ в __develop__ (так как мы хотим, 
чтобы правка попала и в __develop__). 

Теперь можно удалить ветку с правкой.

## Время поговорить о коммитах

Давайте поговорим о сообщениях коммитов в __Git__. 
Намного проще будет просматривать историю, 
если разработчики придерживаются единого формата сообщений коммитов. 

Вот несколько хороших правил:

* Первая строка должна содержать краткую суть коммита 
(желательно до 50 символов).
* Если заглавная строка требует пояснения, можно, пропустив одну строку, 
написать дополнительное описание. 
Описание должно быть оформлено в виде параграфа, с правильным озаглавливанием и пунктуацией.
* Сообщения коммита необходимо разбивать на строки длиной до 72 символов, 
чтобы журнал коммитов нормально отображался в терминалах.
* комит должен быть атомарным
* комит должен содержать только нужное, внимательно просмаривайте изменения

### Стиль написания коммитов

За основу берем стандарт именования коммитов [Angular](https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines).

	<type>(<scope>): <subject>

* `<type>` – тип коммита, должен быть один из следующих:
  * `feat`: добавление нового функционала
  * `fix`: исправление какой-либо программной ошибки
  * `docs`: изменения в документации
  * `style`: изменения в коде, не затрагивающие его содержание (форматирование, добавление точек с запятой и т.д.)
  * `refactor`: изменения в коде, не исправляющие ошибок и не добавляющие новый функционал
  * `perf`: изменения в коде, улучшающие произодительность
  * `test`: добавление новых тестов или исправление существующих
  * `chore`: любые другие изменения, не затрагивающие код
* `<scope>` – уточнение места или функционала, затронутого изменением в коммите (название файла, масштаб изменения и т.д.)
* `<subject>` – содержание сообщения, “что именно было сделано?”

К написанию текста в `<subject>` также имеются несколько ограничивающих требований:

* предложение должно начинаться с глагола в неопределенной форме – т.е. `change` а не `changed` или `changes`
* первая буква предложения должна быть строчной
* в конце предложения не должна ставиться точка (`.`)
* длина строки не должна превышать 72 символа (в идеале 50 символов) – GitHub обрезает сообщение коммита, если оно длиннее этой отметки

Добавление `<scope>` может быть выборочным – так, например, мы иногда его не добавляем.

## Чистка кода и рефакторинг

На первый взгяд ничего страшного в том, что мы где-то отформатируем код.
Но если в этом же файле кто-то внесет изменения, 
то при слиянии ветки будет конфликт.

Чистку кода или рефакторинг можно делать, когда Вы уверены, 
что с текущим кодом работаете только вы.

## Комиты, как точки опоры

Делайте комиты, когда код работает корректно.
Пусть код еще не идеален, но он работает.

Например, код работает и мы его закомитили.
Затем делаем рефокторинг кода.
В случае неудачного рефакторинга, когда Вы получили не рабочий код, 
есть возможность отката изменений к рабочему состоянию.

Комитим каждый шаг рефакторинга, чтобы зафиксировать рабочее состояние.
